# ==============================================================================
# GLOBAL CONFIGURATION
# ==============================================================================
global:
  environment: prod
  clusterDomain: cluster.local
  imagePullSecrets: []

# ==============================================================================
# METADATA
# ==============================================================================
metadata:
  namespace: salt
  labels:
    app.kubernetes.io/name: salt-app
    app.kubernetes.io/component: frontend
    app.kubernetes.io/part-of: salt
    app.kubernetes.io/managed-by: Helm
  annotations: {}

# ==============================================================================
# IMAGE CONFIGURATION
# ==============================================================================
image:
  repository: surflocally/salt-app
  tag: prod-latest
  pullPolicy: Always
  pullSecrets: []

# ==============================================================================
# DEPLOYMENT CONFIGURATION
# ==============================================================================
deployment:
  # Single replica for small cluster
  replicaCount: 1
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0
  podDisruptionBudget:
    enabled: false
  restartPolicy: Always

# ==============================================================================
# RESOURCE MANAGEMENT
# ==============================================================================
# Conservative limits for Raspberry Pi 4 (4GB RAM)
# Nginx is lightweight, so we can use smaller limits
resources:
  limits:
    cpu: 200m
    memory: 128Mi
  requests:
    cpu: 50m
    memory: 64Mi

# ==============================================================================
# NETWORKING
# ==============================================================================
service:
  type: NodePort
  ports:
    - name: http
      port: 80
      targetPort: 80
      protocol: TCP
      nodePort: 30080
  annotations: {}
  sessionAffinity: None

ingress:
  enabled: true
  className: traefik
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    traefik.ingress.kubernetes.io/router.tls: "true"
  hosts:
    - host: surflocal.app
      paths:
        - path: /
          pathType: Prefix
    - host: www.surflocal.app
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: surflocal-app-tls
      hosts:
        - surflocal.app
        - www.surflocal.app

# ==============================================================================
# SECURITY
# ==============================================================================
securityContext:
  pod:
    runAsNonRoot: false
    fsGroup: 101
  container:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: false

rbac:
  enabled: true
  serviceAccount:
    create: true
    name: ""
    annotations: {}

# ==============================================================================
# HEALTH CHECKS
# ==============================================================================
healthChecks:
  liveness:
    enabled: true
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3
  readiness:
    enabled: true
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3

# ==============================================================================
# SCHEDULING
# ==============================================================================
scheduling:
  nodeSelector: {}
  tolerations: []
  affinity: {}
  priorityClassName: ""

# ==============================================================================
# MONITORING
# ==============================================================================
monitoring:
  metrics:
    enabled: false
    port: 9090
    path: /metrics
    serviceMonitor:
      enabled: false
      interval: 30s
  logging:
    level: info
    format: json

# ==============================================================================
# AUTOSCALING
# ==============================================================================
# Horizontal Pod Autoscaler for frontend app (nginx serving static files)
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 4
  # Nginx is lightweight, can handle more load before scaling
  # Scale up at 80% CPU utilization
  targetCPUUtilizationPercentage: 80
  # Memory is typically stable for static serving, scale at 80%
  targetMemoryUtilizationPercentage: 80
  # Wait 5 minutes before scaling down to avoid thrashing
  scaleDownStabilizationSeconds: 300
  # Scale up immediately when needed
  scaleUpStabilizationSeconds: 0
